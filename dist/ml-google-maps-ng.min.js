!function(){"use strict";angular.module("ml.google-maps",["ui.map","ml.google-maps.tpls"])}(),function(){"use strict";angular.module("ml.google-maps").factory("GoogleMaps",["$window",function(e){return e.google.maps}])}(),function(){"use strict";function e(e){function n(e,n,o,t){return this.bounds_=e,this.map_=n,this.count_=o,this.icon_=t,this.div_=null,this.setMap(n),this}return n.prototype=new e.OverlayView,n.prototype.onAdd=function(){var e=document.createElement("div");e.className="map-cluster-icon icon"+this.icon_,e.innerHTML="<span>"+this.count_+"</span>",this.div_=e;var n=this.getPanes();n.overlayLayer.appendChild(e)},n.prototype.draw=function(){var e=this.getProjection(),n=e.fromLatLngToDivPixel(this.bounds_.getCenter()),o=30+10*(""+this.count_).length,t=this.div_;t&&(t.style.left=Math.round(n.x-o/2)+"px",t.style.top=Math.round(n.y-o/2)+"px",t.style.width=o+"px",t.style.height=o+"px",t.style.lineHeight=o+"px",t.style.backgroundSize="100%")},n.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},{createMarker:function(o,t,a,r){var i=new e.LatLngBounds(new e.LatLng(t.s,t.w),new e.LatLng(t.n,t.e));return 1===t.count&&t.uri?new e.Marker({position:i.getCenter(),map:o,title:t.uri,icon:"/images/map/p"+r+".png"}):new n(i,o,t.count,r)}}}angular.module("ml.google-maps").factory("MLGoogleMapMarkerFactory",["GoogleMaps",e])}(),function(){"use strict";angular.module("ml.google-maps").filter("hasBoxes",function(){return function(e,n){var o=[];return angular.forEach(e,function(e){e&&e.boxes&&o.push(e)}),o}}).directive("mlGoogleSearchMapLegend",[function(){return{restrict:"E",scope:{facets:"=facets"},templateUrl:"/ml-google-maps-ng/ml-google-search-map-legend.html",link:function(e,n,o){}}}])}(),function(){"use strict";angular.module("ml.google-maps").directive("mlGoogleSearchMap",["$timeout",function(e){return{restrict:"E",controller:"MLGoogleSearchMapController",scope:{map:"=map",options:"=options",facets:"=facets",markers:"=markers",overlayOptions:"=overlayOptions",overlays:"=overlays",selections:"=selections",parentBoundsChanged:"&boundsChanged",parentShowResult:"&showResult",parentShowContextMenu:"&showContextMenu"},templateUrl:"/ml-google-maps-ng/ml-google-search-map.html",link:function(n,o,t,a){n.$watch("$parent."+t.facets,function(e){e&&a.repaintMap(e)}),n.dragend=function(){n.options.center.lat()!==n.map.getCenter().lat()&&n.options.center.lng()!==n.map.getCenter().lng()&&(n.options.center=n.map.getCenter(),n.parentBoundsChanged({bounds:n.map.getBounds()}))},n.zoomChanged=function(){n.options.zoom!==n.map.getZoom()&&(n.options.zoom=n.map.getZoom(),n.parentBoundsChanged({bounds:n.map.getBounds()}))},n.maptypeidChanged=function(){n.options.mapTypeId!==n.map.getMapTypeId()&&(n.options.mapTypeId=n.map.getMapTypeId())},n.rightclick=function(){n.parentShowContextMenu&&n.parentShowContextMenu()},n.overlayComplete=function(e){n.parentBoundsChanged({bounds:e.overlay.getBounds()})},n.$watch("$parent."+t.options+".center",function(o){o&&n.map&&e(function(){google.maps.event.trigger(n.map,"resize"),n.map.setCenter(o)},0,!1)}),n.$watch("$parent."+t.options+".zoom",function(o){o&&n.map&&e(function(){google.maps.event.trigger(n.map,"resize"),n.map.setZoom(o)},0,!1)}),n.$watch("$parent."+t.options+".mapTypeId",function(o){o&&n.map&&e(function(){n.map.setMapTypeId(o)},0,!1)}),n.showResult=function(e){return n.parentShowResult({uri:e})}}}}]).controller("MLSearchMapController",["MLGoogleMapMarkerFactory","$scope","$timeout",function(e,n,o){function t(o){var t,a,r=0;for(t in o)a=o[t],a&&a.boxes&&(r++,angular.forEach(a.boxes,function(o,t){n.markers.push(e.createMapMarker(n.map,o,t,r))}))}function a(){n.markers&&(angular.forEach(n.markers,function(e,n){e.setMap(null)}),n.markers.length=0)}function r(){n.map&&(google.maps.event.trigger(n.map,"resize"),n.options&&n.map.setCenter(n.options.center))}var i={};angular.extend(i,n.options),this.repaintMap=function(e){!function(e){o(function(){a(),n.overlays&&0===n.overlays.length&&angular.forEach(n.overlayOptions,function(e,o){var t=new google.maps.GroundOverlay(e.image,e.bounds);t.setMap(n.map),n.overlays.push(t)}),t(e),n.drawingManager||(n.drawingManager=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.RECTANGLE]},markerOptions:{icon:"images/beachflag.png"},circleOptions:{fillColor:"#ffff00",fillOpacity:1,strokeWeight:5,clickable:!1,editable:!0,zIndex:1}}),n.drawingManager.setMap(n.map),google.maps.event.addListener(n.drawingManager,"overlaycomplete",function(e){n.selections.push(e.overlay),n.overlayComplete(e)}))},100)}(e)},n.openMarkerInfo=function(e){n.currentMarker=e,n.currentMarkerLat=e.getPosition().lat(),n.currentMarkerLng=e.getPosition().lng(),n.myInfoWindow.open(n.map,e)},n.setMarkerPosition=function(e,n,o){e.setPosition(new google.maps.LatLng(n,o))},n.$on("ml-google-search-map.refresh",function(){o(function(){r()},0,!1)}),function(){o(function(){r()},1e3,!1),o(function(){r()},2e3,!1),o(function(){r()},4e3,!1)}()}])}(),function(e){try{e=angular.module("ml.google-maps.tpls")}catch(n){e=angular.module("ml.google-maps.tpls",[])}e.run(["$templateCache",function(e){e.put("/ml-google-maps-ng/ml-google-search-map-legend.html","<div class=\"map-legend\"><span ng-repeat=\"(index, facet) in facets | object2Array | hasBoxes\"><span ng-class=\"{0: 'map-cluster-icon icon1', 1: 'map-cluster-icon icon2', 2: 'map-cluster-icon icon3', 3: 'map-cluster-icon icon4', 4: 'map-cluster-icon icon5' }[index]\"></span> <label>{{facet.label ? facet.label : facet.__key}}</label></span></div>")}])}(),function(e){try{e=angular.module("ml.google-maps.tpls")}catch(n){e=angular.module("ml.google-maps.tpls",[])}e.run(["$templateCache",function(e){e.put("/ml-google-maps-ng/ml-google-search-map.html","<section class=\"map\"><div ui-map=\"map\" ui-options=\"options\" ui-event=\"{ 'map-bounds_changed': 'boundsChanged()', 'map-center_changed': 'centerChanged()', 'map-click': 'click()', 'map-dblclick': 'dblclick()', 'map-drag': 'drag()', 'map-dragend': 'dragend()', 'map-dragstart': 'dragstart()', 'map-heading_changed': 'headingChanged()', 'map-idle': 'idle()', 'map-maptypeid_changed': 'maptypeidChanged()', 'map-mousemove': 'mousemove()', 'map-mouseout': 'mouseout()', 'map-mouseover': 'mouseover()', 'map-projection_changed': 'projectionChanged()', 'map-resize': 'resize()', 'map-rightclick': 'rightclick()', 'map-tilesloaded': 'tilesloaded()', 'map-tilt_changed': 'tiltChanged()', 'map-zoom_changed': 'zoomChanged()' }\" class=\"map-canvas\"></div><div ng-repeat=\"marker in markers\" ui-map-marker=\"marker\" ui-event=\"{'map-click': 'showResult(marker.title)'}\"></div><div ui-map-info-window=\"myInfoWindow\">Lat: <input ng-model=\"currentMarkerLat\">, Lng: <input ng-model=\"currentMarkerLng\"> <button ng-click=\"setMarkerPosition(currentMarker, currentMarkerLat, currentMarkerLng)\">Update</button></div></section>")}])}();