!function(){"use strict";function e(e,o,n){e.html5Mode(!0),o.otherwise("/"),n.state("home",{url:"/",controller:"mlGoogleMapsDemo.HomeCtrl",controllerAs:"ctrl",templateUrl:"/home.html",resolve:{}}).state("quickstart",{url:"/quickstart",controller:"mlGoogleMapsDemo.HomeCtrl",controllerAs:"ctrl",templateUrl:"/quickstart.html",resolve:{}})}angular.module("mlGoogleMapsDemo",["ui.router","ui.bootstrap","uiGmapgoogle-maps","ml.google-maps","hljs","mlGoogleMapsDemo.Tpls"]).config(["$locationProvider","$urlRouterProvider","$stateProvider",e])}(),function(){"use strict";function e(e,o,n,t,a){o.get("data/geo-facets.json").then(function(e){a.search=e.data}),angular.extend(e,{model:a,boundsChanged:function(){},resetMap:function(){angular.extend(a.searchMap.options,a.searchMap.initOptions),angular.forEach(a.searchMap.selections,function(e,o){e.setMap(null)}),a.searchMap.selections.length=0},showResult:function(e){t.alert("You clicked "+e)}})}angular.module("mlGoogleMapsDemo").factory("HomeModel",["$window",function(e){var o=new e.google.maps.LatLng(52.3881895,4.8447237),n={center:o,zoom:10,mapTypeId:e.google.maps.MapTypeId.ROADMAP},t={};return angular.extend(t,n),{searchMap:{map:null,initOptions:n,options:t,markers:[],selections:[]}}}]).controller("mlGoogleMapsDemo.HomeCtrl",["$scope","$location","$window","HomeModel",e])}(),function(){"use strict";angular.module("ml.google-maps",["ui.map"])}(),function(){"use strict";function e(e,o,n,t){return this.bounds_=e,this.map_=o,this.count_=n,this.icon_=t,this.div_=null,this.setMap(o),this}e.prototype=new google.maps.OverlayView,e.prototype.onAdd=function(){var e=document.createElement("div");e.className="map-cluster-icon icon"+this.icon_,e.innerHTML="<span>"+this.count_+"</span>",this.div_=e;var o=this.getPanes();o.overlayLayer.appendChild(e)},e.prototype.draw=function(){var e=this.getProjection(),o=e.fromLatLngToDivPixel(this.bounds_.getCenter()),n=30+10*(""+this.count_).length,t=this.div_;t&&(t.style.left=Math.round(o.x-n/2)+"px",t.style.top=Math.round(o.y-n/2)+"px",t.style.width=n+"px",t.style.height=n+"px",t.style.lineHeight=n+"px",t.style.backgroundSize="100%")},e.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},angular.module("ml.google-maps").directive("mlSearchMap",["$timeout",function(e){return{restrict:"E",controller:"MLSearchMapController",scope:{map:"=map",options:"=options",facets:"=facets",markers:"=markers",overlayOptions:"=overlayOptions",overlays:"=overlays",selections:"=selections",parentBoundsChanged:"&boundsChanged",parentShowResult:"&showResult",parentShowContextMenu:"&showContextMenu"},templateUrl:"/ml-google-maps-ng/ml-search-map-dir.html",link:function(o,n,t,a){o.$watch("$parent."+t.facets,function(e){e&&a.repaintMap(e)}),o.dragend=function(){o.options.center.lat()!==o.map.getCenter().lat()&&o.options.center.lng()!==o.map.getCenter().lng()&&(o.options.center=o.map.getCenter(),o.parentBoundsChanged({bounds:o.map.getBounds()}))},o.zoomChanged=function(){o.options.zoom!==o.map.getZoom()&&(o.options.zoom=o.map.getZoom(),o.parentBoundsChanged({bounds:o.map.getBounds()}))},o.maptypeidChanged=function(){o.options.mapTypeId!==o.map.getMapTypeId()&&(o.options.mapTypeId=o.map.getMapTypeId())},o.rightclick=function(){o.parentShowContextMenu&&o.parentShowContextMenu()},o.overlayComplete=function(e){o.parentBoundsChanged({bounds:e.overlay.getBounds()})},o.$watch("$parent."+t.options+".center",function(n){n&&o.map&&e(function(){google.maps.event.trigger(o.map,"resize"),o.map.setCenter(n)},0,!1)}),o.$watch("$parent."+t.options+".zoom",function(n){n&&o.map&&e(function(){google.maps.event.trigger(o.map,"resize"),o.map.setZoom(n)},0,!1)}),o.$watch("$parent."+t.options+".mapTypeId",function(n){n&&o.map&&e(function(){o.map.setMapTypeId(n)},0,!1)}),o.showResult=function(e){return o.parentShowResult({uri:e})}}}}]).controller("MLSearchMapController",["$scope","$timeout",function(o,n){function t(e){var n,t,a=0;for(n in e)t=e[n],t&&t.boxes&&(a++,angular.forEach(t.boxes,function(e,n){o.markers.push(r(e,n,a))}))}function a(){o.markers&&(angular.forEach(o.markers,function(e,o){e.setMap(null)}),o.markers.length=0)}function r(n,t,a){var r=new google.maps.LatLngBounds(new google.maps.LatLng(n.s,n.w),new google.maps.LatLng(n.n,n.e));return 1===n.count&&n.uri?new google.maps.Marker({position:r.getCenter(),map:o.map,title:n.uri,icon:"/images/map/p"+a+".png"}):new e(r,o.map,n.count,a)}function i(){o.map&&(google.maps.event.trigger(o.map,"resize"),o.options&&o.map.setCenter(o.options.center))}var s={};angular.extend(s,o.options),this.repaintMap=function(e){!function(e){n(function(){a(),o.overlays&&0===o.overlays.length&&angular.forEach(o.overlayOptions,function(e,n){var t=new google.maps.GroundOverlay(e.image,e.bounds);t.setMap(o.map),o.overlays.push(t)}),t(e,r),o.drawingManager||(o.drawingManager=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.RECTANGLE]},markerOptions:{icon:"images/beachflag.png"},circleOptions:{fillColor:"#ffff00",fillOpacity:1,strokeWeight:5,clickable:!1,editable:!0,zIndex:1}}),o.drawingManager.setMap(o.map),google.maps.event.addListener(o.drawingManager,"overlaycomplete",function(e){o.selections.push(e.overlay),o.overlayComplete(e)}))},100)}(e)},o.openMarkerInfo=function(e){o.currentMarker=e,o.currentMarkerLat=e.getPosition().lat(),o.currentMarkerLng=e.getPosition().lng(),o.myInfoWindow.open(o.map,e)},o.setMarkerPosition=function(e,o,n){e.setPosition(new google.maps.LatLng(o,n))},o.$on("searchmap.refresh",function(){n(function(){i()},0,!1)}),function(){n(function(){i()},1e3,!1),n(function(){i()},2e3,!1),n(function(){i()},4e3,!1)}()}])}(),function(){"use strict";angular.module("ml.google-maps").filter("object2Array",function(){return function(e){var o=[];for(var n in e)e[n].__key=n,o.push(e[n]);return o}}).filter("hasBoxes",function(){return function(e,o){var n=[];return angular.forEach(e,function(e){e&&e.boxes&&n.push(e)}),n}}).directive("mlSearchMapLegend",[function(){return{restrict:"E",scope:{facets:"=facets"},templateUrl:"/ml-google-maps-ng/ml-search-map-legend-dir.html",link:function(e,o,n){}}}])}();