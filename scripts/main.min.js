!function(){"use strict";function e(e,o,t){e.html5Mode(!0),o.otherwise("/"),t.state("home",{url:"/",controller:"mlGoogleMapsDemo.HomeCtrl",controllerAs:"ctrl",templateUrl:"/home.html",resolve:{}}).state("quickstart",{url:"/quickstart",controller:"mlGoogleMapsDemo.HomeCtrl",controllerAs:"ctrl",templateUrl:"/quickstart.html",resolve:{}})}angular.module("mlGoogleMapsDemo",["ui.router","ui.bootstrap","uiGmapgoogle-maps","ml.google-maps","hljs","mlGoogleMapsDemo.Tpls"]).config(["$locationProvider","$urlRouterProvider","$stateProvider",e])}(),function(){"use strict";function e(e,o,t){angular.extend(e,{model:t})}angular.module("mlGoogleMapsDemo").factory("HomeModel",[function(){return{map:{center:{latitude:45,longitude:-73},zoom:8}}}]).controller("mlGoogleMapsDemo.HomeCtrl",["$scope","$location","HomeModel",e])}(),function(){"use strict";angular.module("ml.google-maps",["ui.map"])}(),function(){"use strict";function e(e,o,t,n){return this.bounds_=e,this.map_=o,this.count_=t,this.icon_=n,this.div_=null,this.setMap(o),this}e.prototype=new google.maps.OverlayView,e.prototype.onAdd=function(){var e=document.createElement("div");e.className="map-cluster-icon icon"+this.icon_,e.innerHTML="<span>"+this.count_+"</span>",this.div_=e;var o=this.getPanes();o.overlayLayer.appendChild(e)},e.prototype.draw=function(){var e=this.getProjection(),o=e.fromLatLngToDivPixel(this.bounds_.getCenter()),t=30+10*(""+this.count_).length,n=this.div_;n&&(n.style.left=Math.round(o.x-t/2)+"px",n.style.top=Math.round(o.y-t/2)+"px",n.style.width=t+"px",n.style.height=t+"px",n.style.lineHeight=t+"px",n.style.backgroundSize="100%")},e.prototype.onRemove=function(){this.div_&&(this.div_.parentNode.removeChild(this.div_),this.div_=null)},angular.module("ml.google-maps").directive("mlSearchMap",["$timeout",function(e){return{restrict:"E",controller:"MLSearchMapController",scope:{map:"=map",options:"=options",facets:"=facets",markers:"=markers",overlayOptions:"=overlayOptions",overlays:"=overlays",selections:"=selections",parentBoundsChanged:"&boundsChanged",parentShowResult:"&showResult",parentShowContextMenu:"&showContextMenu"},templateUrl:"ml-search-map-dir.html",link:function(o,t,n,a){o.$watch("$parent."+n.facets,function(e){e&&a.repaintMap(e)}),o.dragend=function(){o.options.center.lat()!==o.map.getCenter().lat()&&o.options.center.lng()!==o.map.getCenter().lng()&&(o.options.center=o.map.getCenter(),o.parentBoundsChanged({bounds:o.map.getBounds()}))},o.zoomChanged=function(){o.options.zoom!==o.map.getZoom()&&(o.options.zoom=o.map.getZoom(),o.parentBoundsChanged({bounds:o.map.getBounds()}))},o.maptypeidChanged=function(){o.options.mapTypeId!==o.map.getMapTypeId()&&(o.options.mapTypeId=o.map.getMapTypeId())},o.rightclick=function(){o.parentShowContextMenu&&o.parentShowContextMenu()},o.overlayComplete=function(e){o.parentBoundsChanged({bounds:e.overlay.getBounds()})},o.$watch("$parent."+n.options+".center",function(t){t&&o.map&&e(function(){google.maps.event.trigger(o.map,"resize"),o.map.setCenter(t)},0,!1)}),o.$watch("$parent."+n.options+".zoom",function(t){t&&o.map&&e(function(){google.maps.event.trigger(o.map,"resize"),o.map.setZoom(t)},0,!1)}),o.$watch("$parent."+n.options+".mapTypeId",function(t){t&&o.map&&e(function(){o.map.setMapTypeId(t)},0,!1)}),o.showResult=function(e){return o.parentShowResult({uri:e})}}}}]).controller("MLSearchMapController",["$scope","$timeout",function(o,t){function n(e){var t,n,a=0;for(t in e)n=e[t],n&&n.boxes&&(a++,angular.forEach(n.boxes,function(e,t){o.markers.push(r(e,t,a))}))}function a(){o.markers&&(angular.forEach(o.markers,function(e,o){e.setMap(null)}),o.markers.length=0)}function r(t,n,a){var r=new google.maps.LatLngBounds(new google.maps.LatLng(t.s,t.w),new google.maps.LatLng(t.n,t.e));return 1===t.count&&t.uri?new google.maps.Marker({position:r.getCenter(),map:o.map,title:t.uri,icon:"/images/map/p"+a+".png"}):new e(r,o.map,t.count,a)}function i(){o.map&&(google.maps.event.trigger(o.map,"resize"),o.options&&o.map.setCenter(o.options.center))}var s={};angular.extend(s,o.options),this.repaintMap=function(e){!function(e){t(function(){a(),o.overlays&&0===o.overlays.length&&angular.forEach(o.overlayOptions,function(e,t){var n=new google.maps.GroundOverlay(e.image,e.bounds);n.setMap(o.map),o.overlays.push(n)}),n(e,r),o.drawingManager||(o.drawingManager=new google.maps.drawing.DrawingManager({drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.RECTANGLE]},markerOptions:{icon:"images/beachflag.png"},circleOptions:{fillColor:"#ffff00",fillOpacity:1,strokeWeight:5,clickable:!1,editable:!0,zIndex:1}}),o.drawingManager.setMap(o.map),google.maps.event.addListener(o.drawingManager,"overlaycomplete",function(e){o.selections.push(e.overlay),o.overlayComplete(e)}))},100)}(e)},o.openMarkerInfo=function(e){o.currentMarker=e,o.currentMarkerLat=e.getPosition().lat(),o.currentMarkerLng=e.getPosition().lng(),o.myInfoWindow.open(o.map,e)},o.setMarkerPosition=function(e,o,t){e.setPosition(new google.maps.LatLng(o,t))},o.$on("searchmap.refresh",function(){t(function(){i()},0,!1)}),function(){t(function(){i()},1e3,!1),t(function(){i()},2e3,!1),t(function(){i()},4e3,!1)}()}])}(),function(){"use strict";angular.module("ml.google-maps").filter("hasBoxes",function(){return function(e,o){var t=[];return angular.forEach(e,function(e){e&&e.boxes&&t.push(e)}),t}}).directive("mlSearchMapLegend",[function(){return{restrict:"E",scope:{facets:"=facets"},templateUrl:"ml-search-map-legend-dir.html",link:function(e,o,t){}}}])}();